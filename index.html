<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Team Dynamics Diagnostic - Complete Version</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #1e293b;
            line-height: 1.5;
            padding: 16px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: white;
            border-radius: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .nav-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .tab-btn.active {
            background: white;
            color: #1e3a8a;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 12px;
        }
        
        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-bottom: 4px solid #2563eb;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Tables */
        .table-responsive {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th {
            background-color: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #1e3a8a;
            border-bottom: 2px solid #e2e8f0;
        }
        
        td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background-color: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .view-report-btn {
            padding: 6px 14px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .view-report-btn:hover {
            background: #1e3a8a;
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 350px;
        }
        
        /* Assessment Form */
        .language-toggle {
            display: flex;
            background: #f1f5f9;
            border-radius: 30px;
            padding: 4px;
            width: fit-content;
            margin-bottom: 24px;
        }
        
        .lang-btn {
            padding: 8px 24px;
            border: none;
            background: transparent;
            color: #475569;
            cursor: pointer;
            border-radius: 30px;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .lang-btn.active {
            background: #2563eb;
            color: white;
        }
        
        .participant-info {
            background: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1e293b;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .questionnaire-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .dysfunction-title {
            color: #1e3a8a;
            border-left: 4px solid #2563eb;
            padding-left: 16px;
            margin-bottom: 16px;
            font-size: 1.3rem;
        }
        
        .question {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .question-text {
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .rating-scale {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .rating-option {
            flex: 1;
            min-width: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px 4px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .rating-option:hover {
            background: #f1f5f9;
        }
        
        .rating-circle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        
        .rating-circle.selected {
            background: #2563eb;
            color: white;
            border-color: #1e3a8a;
            transform: scale(1.1);
        }
        
        .rating-label {
            font-size: 0.7rem;
            color: #64748b;
            text-align: center;
            font-weight: 500;
        }
        
        /* Share Tab */
        .share-container {
            text-align: center;
        }
        
        .share-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin: 30px 0;
        }
        
        .share-option {
            background: #f8fafc;
            padding: 24px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .share-option:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .share-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }
        
        .share-link-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        #shareableLink {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-family: monospace;
            min-width: 250px;
            font-size: 0.9rem;
        }
        
        .copy-btn {
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .copy-btn:hover {
            background: #1e3a8a;
        }
        
        .qrcode-container {
            margin: 30px auto;
            padding: 24px;
            background: white;
            border-radius: 16px;
            display: inline-block;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Pyramid Visualization */
        .pyramid-container {
            max-width: 800px;
            margin: 30px auto;
        }
        
        .pyramid-level {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 4px 0;
        }
        
        .pyramid-label {
            width: 200px;
            font-weight: 600;
            text-align: right;
            font-size: 0.95rem;
        }
        
        .pyramid-bar-container {
            flex: 1;
            height: 44px;
            background: #f1f5f9;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .pyramid-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            width: 0%;
            transition: width 1s;
        }
        
        .pyramid-score {
            width: 60px;
            font-weight: 700;
            color: #2563eb;
            font-size: 1.1rem;
        }
        
        /* Insights Boxes */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .insight-box {
            padding: 24px;
            border-radius: 16px;
            background: #f8fafc;
        }
        
        .strengths {
            border-left: 4px solid #10b981;
        }
        
        .improvements {
            border-left: 4px solid #ef4444;
        }
        
        .recommendations {
            border-left: 4px solid #8b5cf6;
        }
        
        .insight-title {
            font-size: 1.2rem;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insight-list {
            list-style: none;
        }
        
        .insight-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insight-list li:last-child {
            border-bottom: none;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 8px;
            text-transform: uppercase;
        }
        
        .priority-high {
            background: #ef4444;
            color: white;
        }
        
        .priority-medium {
            background: #f59e0b;
            color: white;
        }
        
        .priority-low {
            background: #10b981;
            color: white;
        }
        
        /* Score colors */
        .score-high {
            color: #10b981;
            font-weight: 700;
        }
        
        .score-medium {
            color: #f59e0b;
            font-weight: 700;
        }
        
        .score-low {
            color: #ef4444;
            font-weight: 700;
        }
        
        /* Buttons */
        .buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: #1e3a8a;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            padding: 14px 32px;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        /* Overall Score */
        .overall-score-card {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            margin-bottom: 30px;
        }
        
        .score-large {
            font-size: 4rem;
            font-weight: 700;
            color: #2563eb;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            border-radius: 6px;
            transition: width 1s;
        }
        
        .status-tag {
            display: inline-block;
            padding: 8px 24px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 24px;
            max-width: 900px;
            width: 90%;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: #64748b;
        }
        
        .close-modal:hover {
            color: #1e293b;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: center;
                width: 100%;
            }
            
            .tab-btn {
                flex: 1;
                justify-content: center;
                padding: 10px 12px;
                font-size: 0.85rem;
            }
            
            .rating-option {
                min-width: 50px;
            }
            
            .rating-circle {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .pyramid-level {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .pyramid-label {
                width: 100%;
                text-align: left;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="app-header">
            <div class="logo">
                <i class="fas fa-users-cog"></i>
                <h1>Team Dynamics Diagnostic</h1>
            </div>
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="switchTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="tab-btn" onclick="switchTab('assessment')">
                    <i class="fas fa-clipboard-list"></i> Assessment
                </button>
                <button class="tab-btn" onclick="switchTab('share')">
                    <i class="fas fa-share-alt"></i> Share
                </button>
                <button class="tab-btn" onclick="switchTab('report')">
                    <i class="fas fa-chart-bar"></i> Team Report
                </button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard Overview</span>
                </div>
                <div class="stats-grid" id="dashboardStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalResponses">0</div>
                        <div class="stat-label">Total Responses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgScore">0</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedCount">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingCount">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
                
                <div class="buttons" style="justify-content: flex-end;">
                    <button class="btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                    <button class="btn-primary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-users"></i>
                    <span>Individual Responses</span>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Department</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Score</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="responsesTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-inbox" style="font-size: 2rem; color: #94a3b8;"></i>
                                    <p style="color: #64748b; margin-top: 10px;">No responses yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <canvas id="dashboardRadar"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="dashboardBar"></canvas>
                </div>
            </div>
            
            <div class="insights-grid">
                <div class="insight-box strengths">
                    <h3 class="insight-title">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        Team Strengths
                    </h3>
                    <ul class="insight-list" id="dashboardStrengths">
                        <li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No data available</li>
                    </ul>
                </div>
                <div class="insight-box improvements">
                    <h3 class="insight-title">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                        Priority Areas for Improvement
                    </h3>
                    <ul class="insight-list" id="dashboardImprovements">
                        <li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No data available</li>
                    </ul>
                </div>
                <div class="insight-box recommendations">
                    <h3 class="insight-title">
                        <i class="fas fa-lightbulb" style="color: #8b5cf6;"></i>
                        Recommended Actions
                    </h3>
                    <ul class="insight-list" id="dashboardRecommendations">
                        <li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> Complete assessments first</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Assessment Tab -->
        <div id="assessment" class="tab-content">
            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('en')">English</button>
                <button class="lang-btn" onclick="setLanguage('id')">Bahasa Indonesia</button>
            </div>
            
            <div class="participant-info">
                <h3 style="margin-bottom: 20px; color: #1e3a8a;">
                    <i class="fas fa-user"></i> Participant Information
                </h3>
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="participantName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" id="participantEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Department / Team</label>
                    <input type="text" id="participantDepartment" placeholder="Enter your department">
                </div>
            </div>
            
            <div id="questionnaire"></div>
            
            <div class="buttons">
                <button class="btn-primary" onclick="submitAssessment()">
                    <i class="fas fa-paper-plane"></i> Submit Assessment
                </button>
                <button class="btn-secondary" onclick="resetAssessment()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </div>

        <!-- Share Tab -->
        <div id="share" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-share-alt"></i>
                    <span>Share Assessment</span>
                </div>
                
                <div class="share-options-grid">
                    <div class="share-option" onclick="copyShareLink()">
                        <div class="share-icon"><i class="fas fa-link" style="color: #2563eb;"></i></div>
                        <span>Copy Link</span>
                    </div>
                    <div class="share-option" onclick="shareWhatsApp()">
                        <div class="share-icon"><i class="fab fa-whatsapp" style="color: #25D366;"></i></div>
                        <span>WhatsApp</span>
                    </div>
                    <div class="share-option" onclick="shareEmail()">
                        <div class="share-icon"><i class="fas fa-envelope" style="color: #EA4335;"></i></div>
                        <span>Email</span>
                    </div>
                    <div class="share-option" onclick="toggleQRCode()">
                        <div class="share-icon"><i class="fas fa-qrcode" style="color: #1e3a8a;"></i></div>
                        <span>QR Code</span>
                    </div>
                </div>
                
                <div class="share-link-container">
                    <input type="text" id="shareableLink" readonly value="Loading link..." class="form-control">
                    <button class="copy-btn" onclick="copyShareLink()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                
                <div id="qrcodeContainer" style="display: none; text-align: center;">
                    <h3 style="margin-bottom: 20px;">Scan QR Code</h3>
                    <div id="qrcode"></div>
                </div>
            </div>
        </div>

        <!-- Team Report Tab -->
        <div id="report" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    <span>Team Diagnostic Report</span>
                </div>
                
                <div class="overall-score-card">
                    <div style="font-size: 1.2rem; color: #64748b;">Overall Team Health Score</div>
                    <div class="score-large" id="teamOverallScore">0</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="teamOverallProgress" style="width: 0%;"></div>
                    </div>
                    <span class="status-tag" id="teamScoreStatus">No Data</span>
                </div>
                
                <h3 style="margin: 30px 0 20px; color: #1e3a8a;">
                    <i class="fas fa-layer-group"></i> The Five Dysfunctions Pyramid
                </h3>
                <div class="pyramid-container" id="teamPyramid"></div>
                
                <h3 style="margin: 40px 0 20px; color: #1e3a8a;">
                    <i class="fas fa-chart-pie"></i> Team Radar Chart
                </h3>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="teamRadar"></canvas>
                </div>
                
                <div class="insights-grid">
                    <div class="insight-box strengths">
                        <h3 class="insight-title">
                            <i class="fas fa-check-circle" style="color: #10b981;"></i>
                            Team Strengths
                        </h3>
                        <ul class="insight-list" id="teamStrengths"></ul>
                    </div>
                    <div class="insight-box improvements">
                        <h3 class="insight-title">
                            <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                            Priority Areas (Ranked)
                        </h3>
                        <ul class="insight-list" id="teamImprovements"></ul>
                    </div>
                    <div class="insight-box recommendations">
                        <h3 class="insight-title">
                            <i class="fas fa-lightbulb" style="color: #8b5cf6;"></i>
                            Actionable Recommendations
                        </h3>
                        <ul class="insight-list" id="teamRecommendations"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Individual Report Modal -->
    <div id="reportModal" class="modal" onclick="if(event.target === this) closeModal()">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // ==================== DATA STORAGE ====================
        let assessmentData = JSON.parse(localStorage.getItem('teamDiagnosticData')) || [];
        let currentLanguage = 'en';
        let userResponses = {};

        // Complete translations
        const translations = {
            en: {
                // Dysfunction names
                dysfunction1: "Absence of Trust",
                dysfunction2: "Fear of Conflict",
                dysfunction3: "Lack of Commitment",
                dysfunction4: "Avoidance of Accountability",
                dysfunction5: "Inattention to Results",
                
                // Descriptions
                desc1: "Team members are unwilling to be vulnerable within the group",
                desc2: "Team members avoid productive ideological conflict",
                desc3: "Team members lack clarity or buy-in to decisions",
                desc4: "Team members avoid calling out peers on counterproductive behaviors",
                desc5: "Team members put personal goals ahead of collective results",
                
                // Questions for Dysfunction 1
                q1_1: "Team members readily admit mistakes and weaknesses without fear.",
                q1_2: "Team members ask for help when they need it.",
                q1_3: "Team members offer constructive feedback to one another.",
                q1_4: "Team members acknowledge and tap into one another's skills.",
                q1_5: "Team meetings are open and productive with minimal politics.",
                
                // Questions for Dysfunction 2
                q2_1: "Team discussions are passionate and engaging without personal attacks.",
                q2_2: "Important issues are discussed openly during meetings.",
                q2_3: "Disagreements are resolved without creating lingering resentment.",
                q2_4: "Team members challenge each other's ideas respectfully.",
                q2_5: "All opinions are heard before important decisions are made.",
                
                // Questions for Dysfunction 3
                q3_1: "Team decisions are clear and understood by all members.",
                q3_2: "Team members buy into decisions even when they initially disagree.",
                q3_3: "The team moves forward decisively after decisions are made.",
                q3_4: "Team members align around common objectives.",
                q3_5: "Team meetings end with clear resolutions and next steps.",
                
                // Questions for Dysfunction 4
                q4_1: "Team members hold each other accountable for performance.",
                q4_2: "Poor performance is addressed promptly and directly.",
                q4_3: "Team members feel responsible for the team's overall success.",
                q4_4: "Team members provide unvarnished feedback to peers.",
                q4_5: "Team standards are consistently maintained by all members.",
                
                // Questions for Dysfunction 5
                q5_1: "Team goals take precedence over individual objectives.",
                q5_2: "Team members make sacrifices for the good of the team.",
                q5_3: "Team members are focused on collective outcomes.",
                q5_4: "Team success is celebrated collectively.",
                q5_5: "Team performance metrics are clear and tracked regularly.",
                
                // Rating labels
                rating1: "Strongly Disagree",
                rating2: "Disagree",
                rating3: "Neutral",
                rating4: "Agree",
                rating5: "Strongly Agree",
                
                // Priority labels
                priorityHigh: "HIGH PRIORITY",
                priorityMedium: "MEDIUM PRIORITY",
                priorityLow: "LOW PRIORITY"
            },
            id: {
                // Dysfunction names
                dysfunction1: "Tidak Ada Kepercayaan",
                dysfunction2: "Takut Konflik",
                dysfunction3: "Kurang Komitmen",
                dysfunction4: "Menghindari Akuntabilitas",
                dysfunction5: "Abaikan Hasil Tim",
                
                // Descriptions
                desc1: "Anggota tim tidak mau bersikap rentan dalam kelompok",
                desc2: "Anggota tim menghindari konflik ideologis yang produktif",
                desc3: "Anggota tim kurang kejelasan atau komitmen terhadap keputusan",
                desc4: "Anggota tim menghindari menegur rekan tentang perilaku kontraproduktif",
                desc5: "Anggota tim mengutamakan tujuan pribadi di atas hasil bersama",
                
                // Questions for Dysfunction 1
                q1_1: "Anggota tim dengan mudah mengakui kesalahan dan kelemahan tanpa takut.",
                q1_2: "Anggota tim meminta bantuan saat membutuhkannya.",
                q1_3: "Anggota tim saling memberikan umpan balik konstruktif.",
                q1_4: "Anggota tim mengakui dan memanfaatkan keahlian satu sama lain.",
                q1_5: "Rapat tim terbuka dan produktif dengan minim politik kantor.",
                
                // Questions for Dysfunction 2
                q2_1: "Diskusi tim berlangsung dinamis tanpa serangan pribadi.",
                q2_2: "Masalah penting dibahas secara terbuka selama rapat.",
                q2_3: "Perbedaan pendapat diselesaikan tanpa menimbulkan dendam.",
                q2_4: "Anggota tim saling menantang ide dengan hormat.",
                q2_5: "Semua pendapat didengar sebelum keputusan penting diambil.",
                
                // Questions for Dysfunction 3
                q3_1: "Keputusan tim jelas dan dipahami semua anggota.",
                q3_2: "Anggota tim mendukung keputusan meskipun awalnya tidak setuju.",
                q3_3: "Tim bergerak maju dengan tegas setelah keputusan dibuat.",
                q3_4: "Anggota tim selaras dengan tujuan bersama.",
                q3_5: "Rapat tim diakhiri dengan resolusi dan langkah selanjutnya yang jelas.",
                
                // Questions for Dysfunction 4
                q4_1: "Anggota tim saling meminta pertanggungjawaban atas kinerja.",
                q4_2: "Kinerja buruk ditangani dengan cepat dan langsung.",
                q4_3: "Anggota tim merasa bertanggung jawab atas kesuksesan tim secara keseluruhan.",
                q4_4: "Anggota tim memberikan umpan balik jujur kepada rekan.",
                q4_5: "Standar tim dijaga secara konsisten oleh semua anggota.",
                
                // Questions for Dysfunction 5
                q5_1: "Tujuan tim diutamakan di atas tujuan individu.",
                q5_2: "Anggota tim berkorban untuk kebaikan tim.",
                q5_3: "Anggota tim fokus pada hasil kolektif.",
                q5_4: "Keberhasilan tim dirayakan bersama.",
                q5_5: "Metrik kinerja tim jelas dan dilacak secara teratur.",
                
                // Rating labels
                rating1: "Sangat Tidak Setuju",
                rating2: "Tidak Setuju",
                rating3: "Netral",
                rating4: "Setuju",
                rating5: "Sangat Setuju",
                
                // Priority labels
                priorityHigh: "PRIORITAS TINGGI",
                priorityMedium: "PRIORITAS SEDANG",
                priorityLow: "PRIORITAS RENDAH"
            }
        };
        
        // Dysfunction definitions
        const dysfunctions = [
            { id: 1, nameKey: "dysfunction1", descKey: "desc1", questions: ["q1_1","q1_2","q1_3","q1_4","q1_5"] },
            { id: 2, nameKey: "dysfunction2", descKey: "desc2", questions: ["q2_1","q2_2","q2_3","q2_4","q2_5"] },
            { id: 3, nameKey: "dysfunction3", descKey: "desc3", questions: ["q3_1","q3_2","q3_3","q3_4","q3_5"] },
            { id: 4, nameKey: "dysfunction4", descKey: "desc4", questions: ["q4_1","q4_2","q4_3","q4_4","q4_5"] },
            { id: 5, nameKey: "dysfunction5", descKey: "desc5", questions: ["q5_1","q5_2","q5_3","q5_4","q5_5"] }
        ];
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initialized with full features');
            loadQuestionnaire();
            generateShareableLink();
            updateDashboard();
            updateTeamReport();
            
            // Check URL for view parameter
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('view') === 'assessment') {
                switchTab('assessment');
            }
        });
        
        // ==================== TAB MANAGEMENT ====================
        window.switchTab = function(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tab-btn[onclick="switchTab('${tabId}')"]`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            
            // Refresh data if needed
            if (tabId === 'dashboard') {
                updateDashboard();
            } else if (tabId === 'report') {
                updateTeamReport();
            }
        };
        
        // ==================== LANGUAGE ====================
        window.setLanguage = function(lang) {
            currentLanguage = lang;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.lang-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
            
            loadQuestionnaire();
            
            // Refresh displays
            updateDashboard();
            updateTeamReport();
        };
        
        // ==================== QUESTIONNAIRE ====================
        function loadQuestionnaire() {
            const container = document.getElementById('questionnaire');
            container.innerHTML = '';
            
            dysfunctions.forEach(d => {
                const section = document.createElement('div');
                section.className = 'questionnaire-section';
                
                section.innerHTML = `
                    <h3 class="dysfunction-title">${d.id}. ${translations[currentLanguage][d.nameKey]}</h3>
                    <p style="color: #64748b; margin-bottom: 20px;">${translations[currentLanguage][d.descKey]}</p>
                `;
                
                d.questions.forEach((qKey, index) => {
                    const questionId = `${d.id}_${index + 1}`;
                    const currentRating = userResponses[questionId] || 3; // Default to 3
                    
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    
                    let ratingHTML = '<div class="rating-scale">';
                    for (let r = 1; r <= 5; r++) {
                        ratingHTML += `
                            <div class="rating-option" onclick="setRating('${questionId}', ${r})">
                                <div class="rating-circle ${userResponses[questionId] === r ? 'selected' : ''}">${r}</div>
                                <div class="rating-label">${translations[currentLanguage]['rating' + r]}</div>
                            </div>
                        `;
                    }
                    ratingHTML += '</div>';
                    
                    questionDiv.innerHTML = `
                        <div class="question-text">${index + 1}. ${translations[currentLanguage][qKey]}</div>
                        ${ratingHTML}
                    `;
                    
                    section.appendChild(questionDiv);
                });
                
                container.appendChild(section);
            });
            
            // Restore any saved ratings
            Object.keys(userResponses).forEach(key => {
                const rating = userResponses[key];
                const circle = document.querySelector(`.rating-option[onclick="setRating('${key}', ${rating})"] .rating-circle`);
                if (circle) circle.classList.add('selected');
            });
        }
        
        window.setRating = function(questionId, rating) {
            userResponses[questionId] = rating;
            
            // Update UI
            const scale = document.querySelector(`.rating-option[onclick="setRating('${questionId}', ${rating})"]`).parentElement;
            scale.querySelectorAll('.rating-circle').forEach(circle => {
                circle.classList.remove('selected');
            });
            
            const selectedCircle = scale.querySelector(`.rating-option[onclick="setRating('${questionId}', ${rating})"] .rating-circle`);
            if (selectedCircle) {
                selectedCircle.classList.add('selected');
            }
        };
        
        window.resetAssessment = function() {
            userResponses = {};
            document.getElementById('participantName').value = '';
            document.getElementById('participantEmail').value = '';
            document.getElementById('participantDepartment').value = '';
            loadQuestionnaire();
            
            Swal.fire({
                icon: 'success',
                title: currentLanguage === 'en' ? 'Reset Complete' : 'Reset Selesai',
                text: currentLanguage === 'en' ? 'Assessment has been reset' : 'Penilaian telah direset',
                timer: 1500
            });
        };
        
        window.submitAssessment = function() {
            const name = document.getElementById('participantName').value;
            const email = document.getElementById('participantEmail').value;
            
            if (!name || !email) {
                Swal.fire({
                    icon: 'error',
                    title: currentLanguage === 'en' ? 'Missing Information' : 'Informasi Kurang',
                    text: currentLanguage === 'en' ? 'Please enter your name and email' : 'Harap masukkan nama dan email'
                });
                return;
            }
            
            // Check if all questions answered
            const totalQuestions = dysfunctions.reduce((sum, d) => sum + d.questions.length, 0);
            if (Object.keys(userResponses).length < totalQuestions) {
                Swal.fire({
                    icon: 'warning',
                    title: currentLanguage === 'en' ? 'Incomplete' : 'Belum Lengkap',
                    text: currentLanguage === 'en' ? `Please answer all ${totalQuestions} questions` : `Harap jawab semua ${totalQuestions} pertanyaan`
                });
                return;
            }
            
            // Calculate scores
            const scores = {};
            dysfunctions.forEach(d => {
                let total = 0;
                d.questions.forEach((q, idx) => {
                    total += userResponses[`${d.id}_${idx + 1}`] || 3;
                });
                scores[d.id] = Math.round((total / (d.questions.length * 5)) * 100);
            });
            
            // Calculate overall score (weighted)
            const weights = [0.3, 0.25, 0.2, 0.15, 0.1];
            const overallScore = Math.round(
                dysfunctions.reduce((sum, d, idx) => sum + (scores[d.id] * weights[idx]), 0)
            );
            
            // Create response object
            const response = {
                id: Date.now(),
                name: name,
                email: email,
                department: document.getElementById('participantDepartment').value || 'N/A',
                date: new Date().toLocaleDateString(),
                scores: scores,
                overallScore: overallScore,
                timestamp: new Date().toISOString()
            };
            
            // Save to local storage
            assessmentData.push(response);
            localStorage.setItem('teamDiagnosticData', JSON.stringify(assessmentData));
            
            // Reset form
            userResponses = {};
            document.getElementById('participantName').value = '';
            document.getElementById('participantEmail').value = '';
            document.getElementById('participantDepartment').value = '';
            loadQuestionnaire();
            
            // Show success message
            Swal.fire({
                icon: 'success',
                title: currentLanguage === 'en' ? 'Assessment Submitted!' : 'Penilaian Terkirim!',
                text: currentLanguage === 'en' ? 'Thank you for your response' : 'Terima kasih atas partisipasi Anda',
                timer: 2000
            });
            
            // Update displays
            updateDashboard();
            updateTeamReport();
        };
        
        // ==================== DASHBOARD ====================
        function updateDashboard() {
            // Update stats
            document.getElementById('totalResponses').textContent = assessmentData.length;
            
            if (assessmentData.length > 0) {
                const avgScore = Math.round(assessmentData.reduce((sum, r) => sum + r.overallScore, 0) / assessmentData.length);
                document.getElementById('avgScore').textContent = avgScore;
                document.getElementById('completedCount').textContent = assessmentData.length;
                document.getElementById('pendingCount').textContent = 0;
            } else {
                document.getElementById('avgScore').textContent = 0;
                document.getElementById('completedCount').textContent = 0;
                document.getElementById('pendingCount').textContent = 0;
            }
            
            // Update table
            updateResponsesTable();
            
            // Update charts
            updateDashboardCharts();
            
            // Update insights
            updateDashboardInsights();
        }
        
        function updateResponsesTable() {
            const tbody = document.getElementById('responsesTable');
            
            if (assessmentData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 2rem; color: #94a3b8;"></i>
                            <p style="color: #64748b; margin-top: 10px;">No responses yet</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = assessmentData.map(r => {
                const scoreClass = r.overallScore >= 70 ? 'score-high' : (r.overallScore >= 50 ? 'score-medium' : 'score-low');
                return `
                    <tr>
                        <td><strong>${r.name}</strong></td>
                        <td>${r.email}</td>
                        <td>${r.department}</td>
                        <td>${r.date}</td>
                        <td><span class="status-badge status-complete">Complete</span></td>
                        <td class="${scoreClass}">${r.overallScore}</td>
                        <td>
                            <button class="view-report-btn" onclick="viewIndividualReport(${r.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function updateDashboardCharts() {
            if (assessmentData.length === 0) return;
            
            // Calculate averages
            const avgScores = {};
            dysfunctions.forEach(d => {
                const sum = assessmentData.reduce((total, r) => total + r.scores[d.id], 0);
                avgScores[d.id] = Math.round(sum / assessmentData.length);
            });
            
            // Radar Chart
            const radarCtx = document.getElementById('dashboardRadar').getContext('2d');
            if (window.dashboardRadar) window.dashboardRadar.destroy();
            
            window.dashboardRadar = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: dysfunctions.map(d => translations.en[d.nameKey]),
                    datasets: [{
                        label: 'Team Average',
                        data: dysfunctions.map(d => avgScores[d.id]),
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        borderWidth: 2,
                        pointBackgroundColor: dysfunctions.map(d => {
                            const score = avgScores[d.id];
                            return score >= 70 ? '#10b981' : (score >= 50 ? '#f59e0b' : '#ef4444');
                        }),
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: { stepSize: 20 },
                            grid: { color: '#e2e8f0' }
                        }
                    }
                }
            });
            
            // Bar Chart with colors
            const barCtx = document.getElementById('dashboardBar').getContext('2d');
            if (window.dashboardBar) window.dashboardBar.destroy();
            
            const barColors = dysfunctions.map(d => {
                const score = avgScores[d.id];
                return score >= 70 ? '#10b981' : (score >= 50 ? '#f59e0b' : '#ef4444');
            });
            
            window.dashboardBar = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: dysfunctions.map(d => translations.en[d.nameKey]),
                    datasets: [{
                        label: 'Average Score (%)',
                        data: dysfunctions.map(d => avgScores[d.id]),
                        backgroundColor: barColors,
                        borderRadius: 6,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Score: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            grid: { color: '#e2e8f0' }
                        }
                    }
                }
            });
        }
        
        function updateDashboardInsights() {
            if (assessmentData.length === 0) {
                document.getElementById('dashboardStrengths').innerHTML = 
                    '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No data available</li>';
                document.getElementById('dashboardImprovements').innerHTML = 
                    '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No data available</li>';
                document.getElementById('dashboardRecommendations').innerHTML = 
                    '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> Complete assessments first</li>';
                return;
            }
            
            // Calculate averages
            const avgScores = {};
            dysfunctions.forEach(d => {
                const sum = assessmentData.reduce((total, r) => total + r.scores[d.id], 0);
                avgScores[d.id] = Math.round(sum / assessmentData.length);
            });
            
            // Strengths (>= 70)
            const strengths = dysfunctions
                .filter(d => avgScores[d.id] >= 70)
                .map(d => `
                    <li>
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        ${translations.en[d.nameKey]} 
                        <span class="score-high">(${avgScores[d.id]}%)</span>
                    </li>
                `);
            
            // Improvements (<= 60)
            const improvements = dysfunctions
                .filter(d => avgScores[d.id] <= 60)
                .map(d => `
                    <li>
                        <i class="fas fa-exclamation-circle" style="color: #ef4444;"></i>
                        ${translations.en[d.nameKey]} 
                        <span class="score-low">(${avgScores[d.id]}%)</span>
                        <span class="priority-badge priority-high">${translations.en.priorityHigh}</span>
                    </li>
                `);
            
            // Generate recommendations based on lowest scores
            const sortedDys = [...dysfunctions].sort((a, b) => avgScores[a.id] - avgScores[b.id]);
            const recommendations = sortedDys.slice(0, 3).map((d, idx) => {
                const priority = idx === 0 ? 'high' : (idx === 1 ? 'medium' : 'low');
                const priorityClass = `priority-${priority}`;
                const priorityText = translations.en[`priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`];
                
                let action = '';
                switch(d.id) {
                    case 1: action = 'Schedule team building focused on vulnerability and trust'; break;
                    case 2: action = 'Implement structured debate techniques for decisions'; break;
                    case 3: action = 'Clarify decision-making and ensure follow-through'; break;
                    case 4: action = 'Establish peer accountability processes'; break;
                    case 5: action = 'Create team scorecard for collective results'; break;
                }
                
                return `
                    <li>
                        <i class="fas fa-lightbulb" style="color: #8b5cf6;"></i>
                        ${action}
                        <span class="priority-badge ${priorityClass}">${priorityText}</span>
                    </li>
                `;
            });
            
            document.getElementById('dashboardStrengths').innerHTML = strengths.length ? strengths.join('') : 
                '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No significant strengths identified</li>';
            
            document.getElementById('dashboardImprovements').innerHTML = improvements.length ? improvements.join('') :
                '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No critical areas identified</li>';
            
            document.getElementById('dashboardRecommendations').innerHTML = recommendations.join('');
        }
        
        window.refreshDashboard = function() {
            assessmentData = JSON.parse(localStorage.getItem('teamDiagnosticData')) || [];
            updateDashboard();
            
            Swal.fire({
                icon: 'success',
                title: currentLanguage === 'en' ? 'Refreshed' : 'Diperbarui',
                text: currentLanguage === 'en' ? 'Dashboard updated' : 'Dashboard diperbarui',
                timer: 1500
            });
        };
        
        // ==================== TEAM REPORT ====================
        function updateTeamReport() {
            if (assessmentData.length === 0) {
                document.getElementById('teamOverallScore').textContent = '0';
                document.getElementById('teamOverallProgress').style.width = '0%';
                document.getElementById('teamScoreStatus').textContent = 'No Data';
                document.getElementById('teamPyramid').innerHTML = '';
                document.getElementById('teamStrengths').innerHTML = '<li>No data available</li>';
                document.getElementById('teamImprovements').innerHTML = '<li>No data available</li>';
                document.getElementById('teamRecommendations').innerHTML = '<li>Complete assessments first</li>';
                return;
            }
            
            // Calculate averages
            const avgScores = {};
            dysfunctions.forEach(d => {
                const sum = assessmentData.reduce((total, r) => total + r.scores[d.id], 0);
                avgScores[d.id] = Math.round(sum / assessmentData.length);
            });
            
            const overallAvg = Math.round(assessmentData.reduce((sum, r) => sum + r.overallScore, 0) / assessmentData.length);
            
            // Update overall score
            document.getElementById('teamOverallScore').textContent = overallAvg;
            document.getElementById('teamOverallProgress').style.width = overallAvg + '%';
            
            const statusElem = document.getElementById('teamScoreStatus');
            statusElem.className = 'status-tag';
            if (overallAvg >= 70) {
                statusElem.textContent = 'High-Performing Team';
                statusElem.style.background = '#dcfce7';
                statusElem.style.color = '#166534';
            } else if (overallAvg >= 50) {
                statusElem.textContent = 'Functional Team';
                statusElem.style.background = '#fef9c3';
                statusElem.style.color = '#854d0e';
            } else {
                statusElem.textContent = 'Needs Development';
                statusElem.style.background = '#fee2e2';
                statusElem.style.color = '#991b1b';
            }
            
            // Generate pyramid
            let pyramidHTML = '';
            for (let i = 5; i >= 1; i--) {
                const dysfunction = dysfunctions.find(d => d.id === i);
                const score = avgScores[i];
                pyramidHTML += `
                    <div class="pyramid-level">
                        <div class="pyramid-label">${i}. ${translations.en[dysfunction.nameKey]}</div>
                        <div class="pyramid-bar-container">
                            <div class="pyramid-bar" style="width: ${score}%"></div>
                        </div>
                        <div class="pyramid-score ${score >= 70 ? 'score-high' : (score >= 50 ? 'score-medium' : 'score-low')}">${score}%</div>
                    </div>
                `;
            }
            document.getElementById('teamPyramid').innerHTML = pyramidHTML;
            
            // Radar chart
            const radarCtx = document.getElementById('teamRadar').getContext('2d');
            if (window.teamRadar) window.teamRadar.destroy();
            
            window.teamRadar = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: dysfunctions.map(d => translations.en[d.nameKey]),
                    datasets: [{
                        label: 'Team Average',
                        data: dysfunctions.map(d => avgScores[d.id]),
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        borderWidth: 2,
                        pointBackgroundColor: dysfunctions.map(d => {
                            const score = avgScores[d.id];
                            return score >= 70 ? '#10b981' : (score >= 50 ? '#f59e0b' : '#ef4444');
                        }),
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: { stepSize: 20 }
                        }
                    }
                }
            });
            
            // Generate insights
            const strengths = dysfunctions
                .filter(d => avgScores[d.id] >= 70)
                .map(d => `
                    <li>
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                        ${translations.en[d.nameKey]} 
                        <span class="score-high">(${avgScores[d.id]}%)</span>
                    </li>
                `);
            
            const improvements = dysfunctions
                .filter(d => avgScores[d.id] <= 60)
                .sort((a, b) => avgScores[a.id] - avgScores[b.id])
                .map(d => {
                    const priority = avgScores[d.id] < 40 ? 'high' : (avgScores[d.id] < 55 ? 'medium' : 'low');
                    const priorityClass = `priority-${priority}`;
                    const priorityText = translations.en[`priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`];
                    
                    return `
                        <li>
                            <i class="fas fa-exclamation-circle" style="color: #ef4444;"></i>
                            ${translations.en[d.nameKey]} 
                            <span class="score-low">(${avgScores[d.id]}%)</span>
                            <span class="priority-badge ${priorityClass}">${priorityText}</span>
                        </li>
                    `;
                });
            
            // Generate recommendations based on priority
            const sortedForRecs = [...dysfunctions].sort((a, b) => avgScores[a.id] - avgScores[b.id]);
            const recommendations = sortedForRecs.slice(0, 3).map((d, idx) => {
                const priority = idx === 0 ? 'high' : (idx === 1 ? 'medium' : 'low');
                const priorityClass = `priority-${priority}`;
                const priorityText = translations.en[`priority${priority.charAt(0).toUpperCase() + priority.slice(1)}`];
                
                let action = '';
                switch(d.id) {
                    case 1: action = 'Schedule vulnerability-based team building exercises and "failure debriefs"'; break;
                    case 2: action = 'Implement structured debate techniques and establish ground rules for conflict'; break;
                    case 3: action = 'End meetings with clear decisions and next steps; implement "disagree and commit"'; break;
                    case 4: action = 'Create peer accountability processes and regular feedback sessions'; break;
                    case 5: action = 'Develop team scorecard and align individual metrics with team goals'; break;
                }
                
                return `
                    <li>
                        <i class="fas fa-lightbulb" style="color: #8b5cf6;"></i>
                        ${action}
                        <span class="priority-badge ${priorityClass}">${priorityText}</span>
                    </li>
                `;
            });
            
            document.getElementById('teamStrengths').innerHTML = strengths.length ? strengths.join('') : 
                '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No significant strengths identified</li>';
            
            document.getElementById('teamImprovements').innerHTML = improvements.length ? improvements.join('') :
                '<li><i class="fas fa-info-circle" style="color: #94a3b8;"></i> No critical areas identified</li>';
            
            document.getElementById('teamRecommendations').innerHTML = recommendations.join('');
        }
        
        // ==================== SHARE FUNCTIONALITY ====================
        function generateShareableLink() {
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = baseUrl + '?view=assessment';
            document.getElementById('shareableLink').value = shareUrl;
            
            // Generate QR code
            const qrcodeDiv = document.getElementById('qrcode');
            qrcodeDiv.innerHTML = '';
            if (typeof QRCode !== 'undefined') {
                new QRCode(qrcodeDiv, {
                    text: shareUrl,
                    width: 200,
                    height: 200
                });
            }
        }
        
        window.copyShareLink = function() {
            const linkInput = document.getElementById('shareableLink');
            linkInput.select();
            document.execCommand('copy');
            
            Swal.fire({
                icon: 'success',
                title: currentLanguage === 'en' ? 'Copied!' : 'Tersalin!',
                text: currentLanguage === 'en' ? 'Link copied to clipboard' : 'Link tersalin ke clipboard',
                timer: 1500
            });
        };
        
        window.shareWhatsApp = function() {
            const text = currentLanguage === 'en' ? 
                "Please complete our team diagnostic assessment: " : 
                "Harap lengkapi assessment diagnostik tim kami: ";
            const link = document.getElementById('shareableLink').value;
            window.open(`https://wa.me/?text=${encodeURIComponent(text + link)}`, '_blank');
        };
        
        window.shareEmail = function() {
            const subject = currentLanguage === 'en' ? 
                "Team Diagnostic Assessment" : 
                "Assessment Diagnostik Tim";
            const body = (currentLanguage === 'en' ? 
                "Please complete our team diagnostic assessment:\n\n" : 
                "Harap lengkapi assessment diagnostik tim kami:\n\n") + 
                document.getElementById('shareableLink').value;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        };
        
        window.toggleQRCode = function() {
            const container = document.getElementById('qrcodeContainer');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        };
        
        // ==================== INDIVIDUAL REPORT ====================
        window.viewIndividualReport = function(responseId) {
            const response = assessmentData.find(r => r.id === responseId);
            if (!response) return;
            
            const modal = document.getElementById('reportModal');
            const content = document.getElementById('modalContent');
            
            // Generate pyramid for individual
            let pyramidHTML = '';
            for (let i = 5; i >= 1; i--) {
                const dysfunction = dysfunctions.find(d => d.id === i);
                const score = response.scores[i];
                const scoreClass = score >= 70 ? 'score-high' : (score >= 50 ? 'score-medium' : 'score-low');
                
                pyramidHTML += `
                    <div class="pyramid-level">
                        <div class="pyramid-label">${i}. ${translations.en[dysfunction.nameKey]}</div>
                        <div class="pyramid-bar-container">
                            <div class="pyramid-bar" style="width: ${score}%"></div>
                        </div>
                        <div class="pyramid-score ${scoreClass}">${score}%</div>
                    </div>
                `;
            }
            
            // Find strengths and weaknesses
            const strengths = dysfunctions
                .filter(d => response.scores[d.id] >= 70)
                .map(d => `<li><i class="fas fa-check-circle" style="color: #10b981;"></i> ${translations.en[d.nameKey]} (${response.scores[d.id]}%)</li>`);
            
            const weaknesses = dysfunctions
                .filter(d => response.scores[d.id] <= 60)
                .sort((a, b) => response.scores[a.id] - response.scores[b.id])
                .map(d => `<li><i class="fas fa-exclamation-circle" style="color: #ef4444;"></i> ${translations.en[d.nameKey]} (${response.scores[d.id]}%)</li>`);
            
            content.innerHTML = `
                <h2 style="color: #1e3a8a; margin-bottom: 20px;">Individual Report: ${response.name}</h2>
                <p style="color: #64748b; margin-bottom: 30px;">${response.department} | ${response.date}</p>
                
                <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-radius: 12px; margin-bottom: 30px;">
                    <div style="font-size: 1.2rem; color: #64748b;">Overall Score</div>
                    <div style="font-size: 3rem; font-weight: 700; ${response.overallScore >= 70 ? 'color: #10b981' : (response.overallScore >= 50 ? 'color: #f59e0b' : 'color: #ef4444')}">${response.overallScore}</div>
                </div>
                
                <h3 style="margin: 30px 0 20px;">Five Dysfunctions Profile</h3>
                <div class="pyramid-container">${pyramidHTML}</div>
                
                <div style="height: 300px; margin: 30px 0;">
                    <canvas id="individualChart"></canvas>
                </div>
                
                <div class="insights-grid" style="margin-top: 30px;">
                    <div class="insight-box strengths">
                        <h4>Perceived Strengths</h4>
                        <ul class="insight-list">
                            ${strengths.length ? strengths.join('') : '<li>No particular strengths identified</li>'}
                        </ul>
                    </div>
                    <div class="insight-box improvements">
                        <h4>Areas for Improvement</h4>
                        <ul class="insight-list">
                            ${weaknesses.length ? weaknesses.join('') : '<li>No critical areas identified</li>'}
                        </ul>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
            
            // Create chart after modal is visible
            setTimeout(() => {
                const ctx = document.getElementById('individualChart').getContext('2d');
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: dysfunctions.map(d => translations.en[d.nameKey]),
                        datasets: [{
                            label: 'Scores',
                            data: dysfunctions.map(d => response.scores[d.id]),
                            backgroundColor: 'rgba(37, 99, 235, 0.2)',
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            pointBackgroundColor: dysfunctions.map(d => {
                                const score = response.scores[d.id];
                                return score >= 70 ? '#10b981' : (score >= 50 ? '#f59e0b' : '#ef4444');
                            }),
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: { min: 0, max: 100 }
                        }
                    }
                });
            }, 100);
        };
        
        window.closeModal = function() {
            document.getElementById('reportModal').style.display = 'none';
        };
        
        // ==================== DATA EXPORT ====================
        window.exportData = function() {
            if (assessmentData.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: currentLanguage === 'en' ? 'No Data' : 'Tidak Ada Data',
                    text: currentLanguage === 'en' ? 'No assessment data to export' : 'Tidak ada data untuk diekspor'
                });
                return;
            }
            
            // Create CSV with headers
            let csv = 'Name,Email,Department,Date,Trust,Conflict,Commitment,Accountability,Results,Overall Score\n';
            
            assessmentData.forEach(r => {
                csv += `"${r.name}","${r.email}","${r.department}","${r.date}",`;
                csv += `${r.scores[1]},${r.scores[2]},${r.scores[3]},${r.scores[4]},${r.scores[5]},`;
                csv += `${r.overallScore}\n`;
            });
            
            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `team-diagnostic-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            Swal.fire({
                icon: 'success',
                title: currentLanguage === 'en' ? 'Exported!' : 'Terekspor!',
                text: currentLanguage === 'en' ? 'Data downloaded as CSV' : 'Data diunduh sebagai CSV',
                timer: 1500
            });
        };
    </script>
</body>
</html>